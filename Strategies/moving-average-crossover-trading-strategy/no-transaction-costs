# 1. Set up the environment by installing necessary libraries for this project:

pip install yfinance
pip install matplotlib
pip install numpy
pip install pandas

# 2. Import sample stock data from yahoo finance

import yfinance as yf
data = yf.download("AMZN", start = "2024-01-01", end = "2024-12-01")
# use head() command to display the first 5 rows to preview data:
print(data.head())

# 3. Implement the moving average crossover trading strategy:

import pandas as pd
import matplotlib as plt
import matplotlib.pyplot as plt

#Calculate simple moving averages, SMA10 and SMA50:
data['SMA10'] = data['Close'].rolling(window=10).mean()
data['SMA50'] = data['Close'].rolling(window=50).mean()

#create a new column 'Signal' and assign 0 to all rows:
data['Signal'] = 0

#Generate buy/sell signals:
data.loc[data['SMA10'] > data['SMA50'], 'Signal'] = 1 # where 1 indicates bullish signal (buy)
data.loc[data['SMA10'] <= data['SMA50'], 'Signal'] = -1 # where -1 indicates bearish signal (sell)

#Plot the results:
plt.figure(figsize=(14, 7))
plt.plot(data['Close'], label='Close Price', alpha=0.5) #alpha controls the transparency of plot elements in matplotlib
plt.plot(data['SMA10'], label='10-Day SMA', alpha=0.75)
plt.plot(data['SMA50'], label='50-Day SMA', alpha=0.75)
plt.title('Moving Average Crossover Strategy')
plt.legend()
plt.show()

#Count buy and sell signals:
buy_signals = data[data['Signal'] == 1].shape[0]
sell_signals = data[data['Signal'] == -1].shape[0]

print(f'Number of Buy Signals: {buy_signals}')
print(f'Number of Sell Signals: {sell_signals}')

# 4. Evaluate the strategy by:
# a) comparing it to another strategy (buy-and-hold):

# Calculate daily returns
data['Daily Return'] = data['Close'].pct_change()

# Calculate strategy returns
data['Strategy Return'] = data['Signal'].shift(1) * data['Daily Return']  # Shift signal to simulate "next day" action

# Calculate cumulative returns
data['Cumulative Buy-and-Hold'] = (1 + data['Daily Return']).cumprod()
data['Cumulative Strategy'] = (1 + data['Strategy Return']).cumprod()

# Plot the cumulative returns
plt.figure(figsize=(14, 7))
plt.plot(data['Cumulative Buy-and-Hold'], label='Buy-and-Hold', alpha=0.75)
plt.plot(data['Cumulative Strategy'], label='Strategy', alpha=0.75)
plt.title('Cumulative Returns: Strategy vs Buy-and-Hold')
plt.legend()
plt.show()

# Print final returns
buy_and_hold_return = data['Cumulative Buy-and-Hold'].iloc[-1] - 1
strategy_return = data['Cumulative Strategy'].iloc[-1] - 1

print(f"Buy-and-Hold Return: {buy_and_hold_return:.2%}")
print(f"Strategy Return: {strategy_return:.2%}")

# Calculate Sharpe ratios for each strategy:

# Calculate average return and standard deviation for each strategy
average_daily_return_buy_and_hold = data['Daily Return'].mean()
average_daily_return_strategy = data['Strategy Return'].mean()

std_dev_buy_and_hold = data['Daily Return'].std()
std_dev_strategy = data['Strategy Return'].std()

# Assume a risk-free rate of 0 for simplicity
risk_free_rate = 0

# Calculate Sharpe Ratios
sharpe_ratio_buy_and_hold = (average_daily_return_buy_and_hold - risk_free_rate) / std_dev_buy_and_hold
sharpe_ratio_strategy = (average_daily_return_strategy - risk_free_rate) / std_dev_strategy

print(f"Sharpe Ratio (Buy-and-Hold): {sharpe_ratio_buy_and_hold:.2f}")
print(f"Sharpe Ratio (Strategy): {sharpe_ratio_strategy:.2f}") # the higher sharpe ratio, the better
